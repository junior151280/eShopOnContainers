name: Build and Push Basket

on: workflow_dispatch

#on:
#  push:
#    branches: [ main ]
#  pull_request:
#    branches: [ main ]

env:
  AZ_RG_NAME: 'rg-eShopOnContainers'
  AZ_AKS_NAME: 'aks-eShopOnContainers'

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
        
    - name: Docker Login
      uses: docker/login-action@v1.14.1
      with:
        registry: ${{ secrets.ACR_URL }}
        username: ${{ secrets.ACR_LOGIN }}
        password: ${{ secrets.ACR_PASSWORD }}
    
    - name: Build and push Basket.API image
      uses: docker/build-push-action@v2.10.0
      with:
        context: src
        file: src/Services/Basket/Basket.API/Dockerfile
        tags: |
          ${{secrets.ACR_URL}}/eshop/basket.api:linux-latest
        push: true
    